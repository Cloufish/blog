<!DOCTYPE html><html lang="en-US" mode="dark" ><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8"><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"><meta name="generator" content="Jekyll v4.2.0" /><meta property="og:title" content="blackarch-zsh - How I created blackarch-zsh AND How you can create your own too :)" /><meta property="og:locale" content="en" /><meta name="description" content="Then how do ‘I’ create my own? Wait, wait buddy! not so fast! I think the best way to learn it is from me - while explaining how my Dockerfile is structured. So let’s begin, because we have a lot of stuff to process :) ```bash FROM archlinux:latest ENV USER_ID 1000 ENV GROUP_ID 1000 COPY ./pacman.conf /etc/pacman.conf RUN pacman –sync –refresh –sysupgrade –noconfirm core/filesystem core/sudo &amp;&amp; find / -type f ‘(‘ -name ‘.pacnew’ -or -name ‘.pacsave’ ‘)’ -delete 2&gt; /dev/null COPY ./sudoers /etc/sudoers RUN chmod 440 /etc/sudoers &amp;&amp; groupadd –gid $GROUP_ID penelope &amp;&amp; useradd –uid $USER_ID –gid $GROUP_ID –groups wheel –create-home penelope RUN export TERM=xterm &amp;&amp; curl –silent –show-error https://blackarch.org/strap.sh | bash COPY ./entrypoint.sh / WORKDIR /home/penelope" /><meta property="og:description" content="Then how do ‘I’ create my own? Wait, wait buddy! not so fast! I think the best way to learn it is from me - while explaining how my Dockerfile is structured. So let’s begin, because we have a lot of stuff to process :) ```bash FROM archlinux:latest ENV USER_ID 1000 ENV GROUP_ID 1000 COPY ./pacman.conf /etc/pacman.conf RUN pacman –sync –refresh –sysupgrade –noconfirm core/filesystem core/sudo &amp;&amp; find / -type f ‘(‘ -name ‘.pacnew’ -or -name ‘.pacsave’ ‘)’ -delete 2&gt; /dev/null COPY ./sudoers /etc/sudoers RUN chmod 440 /etc/sudoers &amp;&amp; groupadd –gid $GROUP_ID penelope &amp;&amp; useradd –uid $USER_ID –gid $GROUP_ID –groups wheel –create-home penelope RUN export TERM=xterm &amp;&amp; curl –silent –show-error https://blackarch.org/strap.sh | bash COPY ./entrypoint.sh / WORKDIR /home/penelope" /><link rel="canonical" href="https://cloufish.github.io/blog/posts/creating-your-own-docker-pentesting-container/" /><meta property="og:url" content="https://cloufish.github.io/blog/posts/creating-your-own-docker-pentesting-container/" /><meta property="og:site_name" content="Cloufish’s Blog" /><meta property="og:type" content="article" /><meta property="article:published_time" content="2021-02-12T08:46:00+01:00" /><meta name="twitter:card" content="summary" /><meta property="twitter:title" content="blackarch-zsh - How I created blackarch-zsh AND How you can create your own too :)" /><meta name="twitter:site" content="@Cloufisz" /><meta name="google-site-verification" content="google_meta_tag_verification" /> <script type="application/ld+json"> {"description":"Then how do ‘I’ create my own? Wait, wait buddy! not so fast! I think the best way to learn it is from me - while explaining how my Dockerfile is structured. So let’s begin, because we have a lot of stuff to process :) ```bash FROM archlinux:latest ENV USER_ID 1000 ENV GROUP_ID 1000 COPY ./pacman.conf /etc/pacman.conf RUN pacman –sync –refresh –sysupgrade –noconfirm core/filesystem core/sudo &amp;&amp; find / -type f ‘(‘ -name ‘.pacnew’ -or -name ‘.pacsave’ ‘)’ -delete 2&gt; /dev/null COPY ./sudoers /etc/sudoers RUN chmod 440 /etc/sudoers &amp;&amp; groupadd –gid $GROUP_ID penelope &amp;&amp; useradd –uid $USER_ID –gid $GROUP_ID –groups wheel –create-home penelope RUN export TERM=xterm &amp;&amp; curl –silent –show-error https://blackarch.org/strap.sh | bash COPY ./entrypoint.sh / WORKDIR /home/penelope","url":"https://cloufish.github.io/blog/posts/creating-your-own-docker-pentesting-container/","@type":"BlogPosting","headline":"blackarch-zsh - How I created blackarch-zsh AND How you can create your own too :)","dateModified":"2021-06-11T19:18:37+02:00","datePublished":"2021-02-12T08:46:00+01:00","mainEntityOfPage":{"@type":"WebPage","@id":"https://cloufish.github.io/blog/posts/creating-your-own-docker-pentesting-container/"},"@context":"https://schema.org"}</script><title>blackarch-zsh - How I created blackarch-zsh AND How you can create your own too :) | Cloufish's Blog</title><link rel="apple-touch-icon" sizes="180x180" href="/blog/assets/img/favicons/apple-touch-icon.png"><link rel="icon" type="image/png" sizes="32x32" href="/blog/assets/img/favicons/favicon-32x32.png"><link rel="icon" type="image/png" sizes="16x16" href="/blog/assets/img/favicons/favicon-16x16.png"><link rel="manifest" href="/blog/assets/img/favicons/site.webmanifest"><link rel="shortcut icon" href="/blog/assets/img/favicons/favicon.ico"><meta name="apple-mobile-web-app-title" content="Cloufish's Blog"><meta name="application-name" content="Cloufish's Blog"><meta name="msapplication-TileColor" content="#da532c"><meta name="msapplication-config" content="/blog/assets/img/favicons/browserconfig.xml"><meta name="theme-color" content="#ffffff"><link rel="preconnect" href="https://fonts.gstatic.com" crossorigin="anonymous"><link rel="dns-prefetch" href="https://fonts.gstatic.com"><link rel="preconnect" href="https://www.google-analytics.com" crossorigin="use-credentials"><link rel="dns-prefetch" href="https://www.google-analytics.com"><link rel="preconnect" href="https://www.googletagmanager.com" crossorigin="anonymous"><link rel="dns-prefetch" href="https://www.googletagmanager.com"><link rel="preconnect" href="https://cdn.jsdelivr.net"><link rel="dns-prefetch" href="https://cdn.jsdelivr.net"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@4.0.0/dist/css/bootstrap.min.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fortawesome/fontawesome-free@5.11.2/css/all.min.css"><link rel="stylesheet" href="/blog/assets/css/style.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/gh/afeld/bootstrap-toc@1.0.1/dist/bootstrap-toc.min.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/magnific-popup@1.1.0/dist/magnific-popup.min.css"> <script src="https://cdn.jsdelivr.net/npm/jquery@3/dist/jquery.min.js"></script> <script defer src="https://cdn.jsdelivr.net/combine/npm/popper.js@1.15.0,npm/bootstrap@4/dist/js/bootstrap.min.js"></script> <script async src="https://cdn.jsdelivr.net/combine/npm/lozad/dist/lozad.min.js,npm/magnific-popup@1/dist/jquery.magnific-popup.min.js"></script> <script defer src="/blog/assets/js/dist/post.min.js"></script> <script defer src="/blog/app.js"></script> <script defer src="https://www.googletagmanager.com/gtag/js?id="></script> <script> document.addEventListener("DOMContentLoaded", function(event) { window.dataLayer = window.dataLayer || []; function gtag(){dataLayer.push(arguments);} gtag('js', new Date()); gtag('config', ''); }); </script><body data-spy="scroll" data-target="#toc"><div id="sidebar" class="d-flex flex-column align-items-end"><div class="profile-wrapper text-center"><div id="avatar"> <a href="/blog/" alt="avatar" class="mx-auto"> <img src="/blog/avatar.jpg" alt="avatar" onerror="this.style.display='none'"> </a></div><div class="site-title mt-3"> <a href="/blog/">Cloufish's Blog</a></div><div class="site-subtitle font-italic">My own internet corner :)</div></div><ul class="w-100"><li class="nav-item"> <a href="/blog/" class="nav-link"> <i class="fa-fw fas fa-home ml-xl-3 mr-xl-3 unloaded"></i> <span>HOME</span> </a><li class="nav-item"> <a href="/blog/categories/" class="nav-link"> <i class="fa-fw fas fa-stream ml-xl-3 mr-xl-3 unloaded"></i> <span>CATEGORIES</span> </a><li class="nav-item"> <a href="/blog/tags/" class="nav-link"> <i class="fa-fw fas fa-tags ml-xl-3 mr-xl-3 unloaded"></i> <span>TAGS</span> </a><li class="nav-item"> <a href="/blog/archives/" class="nav-link"> <i class="fa-fw fas fa-archive ml-xl-3 mr-xl-3 unloaded"></i> <span>ARCHIVES</span> </a><li class="nav-item"> <a href="/blog/about/" class="nav-link"> <i class="fa-fw fas fa-info ml-xl-3 mr-xl-3 unloaded"></i> <span>ABOUT</span> </a><li class="nav-item"> <a href="/blog/resources/" class="nav-link"> <i class="fa-fw fas fa-info ml-xl-3 mr-xl-3 unloaded"></i> <span>RESOURCES TO LEARN HACKING</span> </a><li class="nav-item"> <a href="/blog/contribute/" class="nav-link"> <i class="fa-fw fas fa-info ml-xl-3 mr-xl-3 unloaded"></i> <span>HELP ME WITH GITHUB PROJECTS</span> </a></ul><div class="sidebar-bottom mt-auto d-flex flex-wrap justify-content-center"> <a href="https://github.com/Cloufish" aria-label="github" target="_blank" rel="noopener"> <i class="fab fa-github-alt"></i> </a> <a href="https://twitter.com/Cloufisz" aria-label="twitter" target="_blank" rel="noopener"> <i class="fab fa-twitter"></i> </a> <a href=" javascript:location.href = 'mailto:' + ['cloufisz','gmail.com'].join('@')" aria-label="email" > <i class="fas fa-envelope"></i> </a> <a href="/blog/feed.xml" aria-label="rss" > <i class="fas fa-rss"></i> </a></div></div><div id="topbar-wrapper" class="row justify-content-center topbar-down"><div id="topbar" class="col-11 d-flex h-100 align-items-center justify-content-between"> <span id="breadcrumb"> <span> <a href="/blog/"> Posts </a> </span> <span>blackarch-zsh - How I created blackarch-zsh AND How you can create your own too :)</span> </span> <i id="sidebar-trigger" class="fas fa-bars fa-fw"></i><div id="topbar-title"> Post</div><i id="search-trigger" class="fas fa-search fa-fw"></i> <span id="search-wrapper" class="align-items-center"> <i class="fas fa-search fa-fw"></i> <input class="form-control" id="search-input" type="search" aria-label="search" autocomplete="off" placeholder="Search..."> <i class="fa fa-times-circle fa-fw" id="search-cleaner"></i> </span> <span id="search-cancel" >Cancel</span></div></div><div id="main-wrapper"><div id="main"><div class="row"><div id="post-wrapper" class="col-12 col-lg-11 col-xl-8"><div class="post pl-1 pr-1 pl-sm-2 pr-sm-2 pl-md-4 pr-md-4"><h1 data-toc-skip>blackarch-zsh - How I created blackarch-zsh AND How you can create your own too :)</h1><div class="post-meta text-muted d-flex flex-column"><div> <span class="semi-bold"> Bartholomew Mokrzycki </span> <span class="timeago " data-toggle="tooltip" data-placement="bottom" title="Fri, Feb 12, 2021, 8:46 AM +0100" prep="on" > Feb 12 <i class="unloaded">2021-02-12T08:46:00+01:00</i> </span></div><div> <span> <span class="timeago lastmod" data-toggle="tooltip" data-placement="bottom" title="Fri, Jun 11, 2021, 7:18 PM +0200" prefix="Updated " > Jun 11 <i class="unloaded">2021-06-11T19:18:37+02:00</i> </span> </span> <span class="readtime" data-toggle="tooltip" data-placement="bottom" title="1634 words">9 min</span></div></div><div class="post-content"><h2 id="then-how-do-i-create-my-own">Then how do ‘I’ create my own?</h2><p>Wait, wait buddy! not so fast!<br /> I think the best way to learn it is from me - while explaining how my <code class="language-plaintext highlighter-rouge">Dockerfile</code> is structured. So let’s begin, because we have a lot of stuff to process :)</p><div class="language-bash highlighter-rouge"><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31
32
33
34
35
36
37
38
39
40
41
42
43
44
45
46
47
48
49
50
51
52
53
54
55
56
57
58
59
60
61
62
63
64
65
66
67
68
69
70
71
72
73
74
75
76
77
78
79
80
81
82
83
84
85
86
87
88
89
90
91
92
93
94
95
96
97
98
99
100
101
102
103
104
105
106
107
108
109
110
111
112
113
114
115
116
117
</pre><td class="rouge-code"><pre>FROM archlinux:latest
ENV USER_ID 1000
ENV GROUP_ID 1000
COPY ./pacman.conf /etc/pacman.conf
RUN pacman <span class="nt">--sync</span> <span class="nt">--refresh</span> <span class="nt">--sysupgrade</span> <span class="nt">--noconfirm</span> core/filesystem core/sudo <span class="o">&amp;&amp;</span> <span class="se">\</span>
find / <span class="nt">-type</span> f <span class="s1">'('</span> <span class="nt">-name</span> <span class="s1">'*.pacnew'</span> <span class="nt">-or</span> <span class="nt">-name</span> <span class="s1">'*.pacsave'</span> <span class="s1">')'</span> <span class="nt">-delete</span> 2&gt; /dev/null
COPY ./sudoers /etc/sudoers
RUN <span class="nb">chmod </span>440 /etc/sudoers <span class="o">&amp;&amp;</span> <span class="se">\</span>
groupadd <span class="nt">--gid</span> <span class="nv">$GROUP_ID</span> penelope <span class="o">&amp;&amp;</span> <span class="se">\</span>
useradd <span class="nt">--uid</span> <span class="nv">$USER_ID</span> <span class="nt">--gid</span> <span class="nv">$GROUP_ID</span> <span class="nt">--groups</span> wheel <span class="nt">--create-home</span> penelope
RUN <span class="nb">export </span><span class="nv">TERM</span><span class="o">=</span>xterm <span class="o">&amp;&amp;</span> curl <span class="nt">--silent</span> <span class="nt">--show-error</span> https://blackarch.org/strap.sh | bash
COPY ./entrypoint.sh /
WORKDIR /home/penelope


RUN pacman <span class="nt">--needed</span> <span class="nt">--noconfirm</span> <span class="nt">-Syu</span> curl <span class="se">\</span>
		wget <span class="se">\</span>
		git <span class="se">\</span>
		go <span class="se">\</span>
		python <span class="se">\</span>
		python-pip <span class="se">\</span>
		iputils <span class="se">\</span>
		ruby <span class="se">\</span>
		zsh <span class="se">\</span>
		gcc <span class="se">\</span>
		openvpn <span class="se">\</span>
		tmux <span class="se">\</span>
		man-db <span class="se">\</span>
		<span class="nb">sudo</span> <span class="se">\</span>
		man-pages <span class="se">\</span>
		nodejs <span class="se">\</span>
		base-devel <span class="se">\</span>
		yarn <span class="se">\</span>
		vim <span class="se">\</span>
		vi <span class="se">\</span>
		npm <span class="se">\</span>
		postgresql <span class="se">\</span>
		ruby-bundler <span class="se">\</span>
		zsh-syntax-highlighting

<span class="c">#Setting up password for penelope</span>
USER root
RUN <span class="nb">echo</span> <span class="s2">"penelope:penelope"</span> | chpasswd


USER penelope


<span class="c"># Setting up zsh and getting Luke Smith's .zshrc and installing oh-my-zsh</span>

RUN sh <span class="nt">-c</span> <span class="s2">"</span><span class="si">$(</span>wget https://raw.github.com/ohmyzsh/ohmyzsh/master/tools/install.sh <span class="nt">-O</span> -<span class="si">)</span><span class="s2">"</span> <span class="o">&amp;&amp;</span> <span class="se">\</span>
<span class="nb">rm</span> ~/.zshrc <span class="o">&amp;&amp;</span> <span class="se">\</span>
wget https://raw.githubusercontent.com/Cloufish/voidrice/master/.config/zsh/.zshrc <span class="nt">-O</span> ~/.zshrc <span class="o">&amp;&amp;</span> <span class="se">\</span>
<span class="nb">echo</span> <span class="s1">'penelope'</span> <span class="o">&gt;</span> chsh <span class="nt">-s</span> /usr/bin/zsh

<span class="c"># DOING THE SAME FOR ROOT USER</span>
USER root
RUN sh <span class="nt">-c</span> <span class="s2">"</span><span class="si">$(</span>wget https://raw.github.com/robbyrussell/oh-my-zsh/master/tools/install.sh <span class="nt">-O</span> -<span class="si">)</span><span class="s2">"</span> <span class="o">&amp;&amp;</span> <span class="se">\</span>
<span class="nb">rm</span> ~/.zshrc <span class="o">&amp;&amp;</span> <span class="se">\</span>
wget https://raw.githubusercontent.com/Cloufish/voidrice/master/.config/zsh/.zshrc <span class="nt">-O</span> ~/.zshrc <span class="o">&amp;&amp;</span> <span class="se">\</span>
chsh <span class="nt">-s</span> /usr/bin/zsh

<span class="c"># Setting up tmux</span>

USER penelope
RUN <span class="nb">mkdir</span> ~/.config/ <span class="o">&amp;&amp;</span> <span class="se">\</span>
<span class="nb">cd</span> ~/.config/ <span class="o">&amp;&amp;</span> <span class="se">\</span>
git clone https://github.com/gpakosz/.tmux.git <span class="o">&amp;&amp;</span> <span class="se">\</span>
<span class="nb">echo</span> <span class="s2">"set -g default-command /usr/sbin/zsh"</span> <span class="o">&gt;&gt;</span>  ~/.config/.tmux/.tmux.conf.local <span class="o">&amp;&amp;</span> <span class="se">\</span>
<span class="nb">ln</span> <span class="nt">-s</span> <span class="nt">-f</span> ~/.config/.tmux/.tmux.conf ~/.tmux.conf <span class="o">&amp;&amp;</span> <span class="se">\</span>
<span class="nb">cp</span> ~/.config/.tmux/.tmux.conf.local ~/.tmux.conf.local

RUN wget https://raw.githubusercontent.com/LukeSmithxyz/voidrice/master/.config/nvim/init.vim <span class="o">&amp;&amp;</span> <span class="se">\</span>
<span class="nb">mkdir</span> ~/.config/nvim <span class="o">&amp;&amp;</span> <span class="se">\</span>
<span class="nb">mv </span>init.vim ~/.config/nvim <span class="o">&amp;&amp;</span> <span class="se">\</span>
<span class="nb">cp</span> ~/.config/nvim/init.vim ~/ <span class="o">&amp;&amp;</span><span class="se">\</span>
<span class="nb">mv </span>init.vim .vimrc <span class="o">&amp;&amp;</span> <span class="se">\</span>

<span class="c"># Setting up man and bat</span>

<span class="nb">export </span><span class="nv">MANPAGER</span><span class="o">=</span><span class="s2">"sh -c 'col -bx | bat -l man -p'"</span> <span class="c"># Setting up environment for non-blackarch-tools and other tools, probably the most important part</span>

RUN <span class="nb">mkdir</span> /home/penelope/PATH <span class="o">&amp;&amp;</span> <span class="se">\</span>

<span class="nb">mkdir</span> <span class="nt">-p</span> /home/penelope/.gem/ruby/2.7.0/bin <span class="o">&amp;&amp;</span> <span class="se">\</span>
<span class="nb">mkdir</span> <span class="nt">-p</span> /home/penelope/.local/bin <span class="o">&amp;&amp;</span> <span class="se">\</span>
git clone https://github.com/Cloufish/non_blackarch_tools.git <span class="o">&amp;&amp;</span> <span class="se">\</span>
<span class="nb">cp</span> /home/penelope/non_blackarch_tools/exploit_databases_init.sh /home/penelope

USER root
RUN <span class="nb">chmod</span> +x /home/penelope/non_blackarch_tools/install.sh



RUN pacman <span class="nt">-Syyu</span> <span class="nt">--noconfirm</span> 

RUN <span class="nb">sed</span>  <span class="nt">-i</span> <span class="s1">'s/^# Server/Server/'</span> <span class="s2">"/etc/pacman.d/blackarch-mirrorlist"</span>

RUN pacman <span class="nt">--needed</span> <span class="nt">--noconfirm</span> <span class="nt">--overwrite</span><span class="o">=</span><span class="s1">'*'</span> <span class="nt">-Syu</span> tmux gcc git vim wget tzdata curl iputils make nmap whois openvpn go python python3 perl jq hq yq nikto subbrute net-tools nano sqlmap cpanminus python-pycurl python-dnspython libxml2 python hydra powerline bat exploitdb beef

RUN pacman <span class="nt">--needed</span> <span class="nt">--noconfirm</span> <span class="nt">--overwrite</span><span class="o">=</span><span class="s1">'*'</span> <span class="nt">-Syu</span> gobuster metabigor joomlascan sublist3r wfuzz beef corsy gdb adb exploitpack radare2

RUN pacman <span class="nt">--needed</span> <span class="nt">--noconfirm</span> <span class="nt">--overwrite</span><span class="o">=</span><span class="s1">'*, usr/lib/python3.8/site-packages/termcolor-1.1.0-py3.8.egg-info/*'</span> <span class="nt">-Syu</span> amass aquatone metabigor gospider subfinder subover webanalyze man parallel unzip dex2jar jadx  assetfinder 

RUN pacman <span class="nt">--needed</span> <span class="nt">--noconfirm</span> <span class="nt">--overwrite</span><span class="o">=</span><span class="s1">'*'</span> <span class="nt">-Syu</span> httprobe unfurl openssh waybackurls whatweb smbclient openldap metasploit msf-mpc gnu-netcat

RUN pacman <span class="nt">--needed</span> <span class="nt">--noconfirm</span> <span class="nt">--overwrite</span><span class="o">=</span><span class="s1">'*'</span> <span class="nt">-Syu</span>  ffuf nuclei corsy smuggler jq subscraper hakrawler brutespray interlace chromium msfdb jdk8-openjdk binwalk smbclient wordlistctl haiti


<span class="c">#RUN sed  -i 's/^Server/# Server/' "/etc/pacman.d/blackarch-mirrorlist"</span>

RUN <span class="nb">cd</span> /home/penelope/non_blackarch_tools <span class="o">&amp;&amp;</span> <span class="se">\</span>
./install.sh <span class="o">&amp;&amp;</span> <span class="se">\</span>
<span class="nb">rm</span> <span class="nt">-rf</span> /home/penelope/non_blackarch_tools

ENTRYPOINT <span class="o">[</span><span class="s2">"sh"</span>,<span class="s2">"/entrypoint.sh"</span><span class="o">]</span>
CMD <span class="o">[</span><span class="s2">"zsh"</span>, <span class="s2">"-ic"</span>, <span class="s2">"tmux"</span><span class="o">]</span>
</pre></table></code></div></div><p>Let’s examine it piece by piece…</p><div class="language-plaintext highlighter-rouge"><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
</pre><td class="rouge-code"><pre>FROM archlinux:latest
</pre></table></code></div></div><ul><li>This is telling us that we’re using archlinux:latest <strong>container</strong> as a base to our image.<div class="language-bash highlighter-rouge"><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
</pre><td class="rouge-code"><pre>ENV USER_ID 1000
ENV GROUP_ID 1000
</pre></table></code></div></div><li>This sets a variable (we can call it even environment variable) that’ll be used when building the image</ul><div class="language-bash highlighter-rouge"><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
</pre><td class="rouge-code"><pre>COPY ./pacman.conf /etc/pacman.conf
RUN pacman <span class="nt">--sync</span> <span class="nt">--refresh</span> <span class="nt">--sysupgrade</span> <span class="nt">--noconfirm</span> core/filesystem core/sudo <span class="o">&amp;&amp;</span> <span class="se">\</span>
find / <span class="nt">-type</span> f <span class="s1">'('</span> <span class="nt">-name</span> <span class="s1">'*.pacnew'</span> <span class="nt">-or</span> <span class="nt">-name</span> <span class="s1">'*.pacsave'</span> <span class="s1">')'</span> <span class="nt">-delete</span> 2&gt; /dev/null
</pre></table></code></div></div><ul><li>This is a setup for pacman.conf (this is not that much necesseary)<li>Then it’s running pacman to do basic initialization after copying a pacman.conf, but it also installes sudo and filesystem packages from core<li>Finally the find command is ran deleting all .pacnew and .pacsave files from the filesystem<blockquote><p>.pacnew and .pacsave are files that store .config files of deleted packages</p></blockquote></ul><div class="language-bash highlighter-rouge"><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
</pre><td class="rouge-code"><pre>COPY ./sudoers /etc/sudoers
RUN <span class="nb">chmod </span>440 /etc/sudoers <span class="o">&amp;&amp;</span> <span class="se">\</span>
groupadd <span class="nt">--gid</span> <span class="nv">$GROUP_ID</span> penelope <span class="o">&amp;&amp;</span> <span class="se">\</span>
useradd <span class="nt">--uid</span> <span class="nv">$USER_ID</span> <span class="nt">--gid</span> <span class="nv">$GROUP_ID</span> <span class="nt">--groups</span> wheel <span class="nt">--create-home</span> penelope
</pre></table></code></div></div><ul><li>Here we copy sudoers file to /etc/sudoers on our future container<li>Then running chmod to so that nobody will have write access to this file (because we access it with <code class="language-plaintext highlighter-rouge">visudo</code> command)<li>Then we’re adding a group called penelope (Notice that we’re using $GROUP_ID variable that we’ve declared before) and a user that is being assing to <strong>two</strong> groupd - wheel and penelope</ul><div class="language-bash highlighter-rouge"><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
</pre><td class="rouge-code"><pre>RUN <span class="nb">export </span><span class="nv">TERM</span><span class="o">=</span>xterm <span class="o">&amp;&amp;</span> curl <span class="nt">--silent</span> <span class="nt">--show-error</span> https://blackarch.org/strap.sh | bash
</pre></table></code></div></div><ul><li>Finally we’re using curl to download script that’ll initialize and add blackarch repository to our… well package repositories, initialize keyring etc.</ul><div class="language-bash highlighter-rouge"><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
</pre><td class="rouge-code"><pre>COPY ./entrypoint.sh
</pre></table></code></div></div><ul><li>This file is pretty important, lets see CONTENTS OF ENTRYPOINT.SH<div class="language-bash highlighter-rouge"><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
</pre><td class="rouge-code"><pre><span class="c">#!/usr/bin/env bash</span>
<span class="o">[[</span> <span class="s2">"</span><span class="nv">$USER_ID</span><span class="s2">"</span> <span class="o">==</span> <span class="s2">"</span><span class="si">$(</span><span class="nb">id</span> <span class="nt">-u</span> penelope<span class="si">)</span><span class="s2">"</span> <span class="o">&amp;&amp;</span> <span class="s2">"</span><span class="nv">$GROUP_ID</span><span class="s2">"</span> <span class="o">==</span> <span class="s2">"</span><span class="si">$(</span><span class="nb">id</span> <span class="nt">-g</span> penelope<span class="si">)</span><span class="s2">"</span> <span class="o">]]</span> <span class="o">||</span> usermod <span class="nt">--uid</span> <span class="s2">"</span><span class="nv">$USER_ID</span><span class="s2">"</span> <span class="nt">--gid</span> <span class="s2">"</span><span class="nv">$GROUP_ID</span><span class="s2">"</span> penelope
<span class="nb">exec sudo</span> <span class="nt">--user</span> penelope <span class="nt">--</span> <span class="s2">"</span><span class="nv">$@</span><span class="s2">"</span>
</pre></table></code></div></div><li>Okaaay, what is it?! (You might ask ;p). The ‘[[’ characters signalize that this is a <code class="language-plaintext highlighter-rouge">if statement</code> - Yeah I know, if statement without if keyword, but in bash it’s somehow possible.<li>So this stamenent checks if we’ve done everything right with creating a user penelope and assigning it to the appropriate groups <strong>OR</strong> if the command <code class="language-plaintext highlighter-rouge">usermod --uid "$USER_ID" --gid "$GROUP_ID" penelope</code> was successful, which will in the end do the same result.<li>After this ‘if statement’ we’re logging as penelope.<li>BUT! We’re only copying this file and we’re not executing it, so what’s going on here?! We’ll see in the future, don’t worry :)<div class="language-bash highlighter-rouge"><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
</pre><td class="rouge-code"><pre>WORKDIR /home/penelope
</pre></table></code></div></div><li>This is important step too, because now every action that we’re going to perform that results in downloading a file, creating another directory etc. will be in that file<blockquote><p>This option is not frequently used in my Dockerfile, only this once, because I often see it more comfortable to just use ‘cd <name_of_directory>', but it's probably a bad practice.</name_of_directory></p></blockquote></ul><div class="language-plaintext highlighter-rouge"><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
</pre><td class="rouge-code"><pre>RUN pacman --needed --noconfirm -Syu curl \
		wget \
		git \
		go \
		python \
		python-pip \
		iputils \
		ruby \
		zsh \
		gcc \
		openvpn \
		tmux \
		man-db \
		sudo \
		man-pages \
		nodejs \
		base-devel \
		yarn \
		vim \
		vi \
		npm \
		postgresql \
		ruby-bundler \
		zsh-syntax-highlighting
        
</pre></table></code></div></div><ul><li>This installed basic utils that should be preinstalled before installing any blackarch tools or git cloning.</ul><div class="language-plaintext highlighter-rouge"><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
</pre><td class="rouge-code"><pre>USER penelope
</pre></table></code></div></div><ul><li>This is super useful, the same goes to <code class="language-plaintext highlighter-rouge">USER root</code>, It is an extra easy way of switching between root user and non-root user without having to input any password, perfect!</ul><div class="language-bash highlighter-rouge"><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
</pre><td class="rouge-code"><pre><span class="c"># Setting up zsh and getting Luke Smith's .zshrc and installing oh-my-zsh</span>

RUN sh <span class="nt">-c</span> <span class="s2">"</span><span class="si">$(</span>wget https://raw.github.com/ohmyzsh/ohmyzsh/master/tools/install.sh <span class="nt">-O</span> -<span class="si">)</span><span class="s2">"</span> <span class="o">&amp;&amp;</span> <span class="se">\</span>
<span class="nb">rm</span> ~/.zshrc <span class="o">&amp;&amp;</span> <span class="se">\</span>
wget https://raw.githubusercontent.com/Cloufish/voidrice/master/.config/zsh/.zshrc <span class="nt">-O</span> ~/.zshrc <span class="o">&amp;&amp;</span> <span class="se">\</span>
<span class="nb">echo</span> <span class="s1">'penelope'</span> <span class="o">&gt;</span> chsh <span class="nt">-s</span> /usr/bin/zsh

</pre></table></code></div></div><ul><li>From this point there’s a lot of my personal customization, it’s getting time and many failed attempts in finding a particular solution to a problem, and you’ll probably find many obstacles yourself when building a Docker container, remember that <strong>Stack Overflow is your friend</strong><li>But are those Stack Overflow answers always secure? In this case we’re just echo’ing password for the non-root user so it’s not something that bad ~ Words said before a disaster! :D</ul><div class="language-bash highlighter-rouge"><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
</pre><td class="rouge-code"><pre>RUN pacman <span class="nt">--needed</span> <span class="nt">--noconfirm</span> <span class="nt">--overwrite</span><span class="o">=</span><span class="s1">'*'</span> <span class="nt">-Syu</span> tmux gcc git vim wget tzdata curl iputils make nmap whois openvpn go 
</pre></table></code></div></div><ul><li>Let’s jump into installing tools from blackarch repository database. The switched are:<li><code class="language-plaintext highlighter-rouge">--needed</code> - so that I won’t reinstall packages unneceseary (because why should I, If a package is installed? ;P)<li><code class="language-plaintext highlighter-rouge">--noconfirm</code> - Is a way of telling the pacman ‘I want this without any prompts!’ basically<li><code class="language-plaintext highlighter-rouge">--overwrite='*'</code> Here is the one of the issues for installing packages with blackarch database. Lot of times there’ll be errors that ‘A package already exists’, but not in a way –needed checks it (I don’t understand it perfectly to be honest), but we’re using this switch to overwrite every package. Is it then neglecting <code class="language-plaintext highlighter-rouge">--needed</code> switch/flag? Tell me in the comments :p</ul><p><strong>Now read again the whole Dockerfile that I’ve provided to you in the beginning and figure out what you don’t understand, then come back here again. It’s to remember it more efficient</strong></p><h2 id="so-how-do-you-create-your-own">So how do you create ‘Your own’?</h2><h3 id="modifying-from-argument">Modifying FROM argument:</h3><ul><li>You can use argument <code class="language-plaintext highlighter-rouge">FROM cloufish/blackarch-zsh-minimal:latest</code> keywoard if you like adventures and if you’re risky player.<li>Or you can just copy the Dockerfile from <a href="https://github.com/Cloufish/dockerfiles/blob/master/blackarch-zsh-minimal/Dockerfile">blackarch-zsh-minimal</a> and then modifying it</ul><h3 id="ive-in-someway-tricked-you-because-the-best-way-of-doing-this-is-through-practice">I’ve in someway tricked you, because the best way of doing this is through practice</h3><ul><li>I’m sorry<li>ごめなさい！</ul><blockquote><p>I’m also not an expert, the knowledge that I’ve gained and this project took me 3 months to make it stable and in some way ‘worth it to publish’. And I would never imagine that it would be that cool after first weeks of struggling with user creation</p></blockquote></div><div class="post-tail-wrapper text-muted"><div class="post-meta mb-3"> <i class="far fa-folder-open fa-fw mr-1"></i> <a href='/blog/categories/docker/'>Docker</a>, <a href='/blog/categories/blackarch-zsh/'>blackarch-zsh</a></div><div class="post-tags"> <i class="fa fa-tags fa-fw mr-1"></i> <a href="/blog/tags/docker/" class="post-tag no-text-decoration" >docker</a> <a href="/blog/tags/pentesting-lab/" class="post-tag no-text-decoration" >pentesting lab</a> <a href="/blog/tags/personal-projects/" class="post-tag no-text-decoration" >personal projects</a></div><div class="post-tail-bottom d-flex justify-content-between align-items-center mt-3 pt-5 pb-2"><div class="license-wrapper"> This post is licensed under <a href="https://creativecommons.org/licenses/by/4.0/">CC BY 4.0</a> by the author.</div><div class="share-wrapper"> <span class="share-label text-muted mr-1">Share</span> <span class="share-icons"> <a href="https://twitter.com/intent/tweet?text=blackarch-zsh - How I created blackarch-zsh AND How you can create your own too :) - Cloufish's Blog&url=https://cloufish.github.io/blog/posts/creating-your-own-docker-pentesting-container/" data-toggle="tooltip" data-placement="top" title="Twitter" target="_blank" rel="noopener" aria-label="Twitter"> <i class="fa-fw fab fa-twitter"></i> </a> <a href="https://www.facebook.com/sharer/sharer.php?title=blackarch-zsh - How I created blackarch-zsh AND How you can create your own too :) - Cloufish's Blog&u=https://cloufish.github.io/blog/posts/creating-your-own-docker-pentesting-container/" data-toggle="tooltip" data-placement="top" title="Facebook" target="_blank" rel="noopener" aria-label="Facebook"> <i class="fa-fw fab fa-facebook-square"></i> </a> <a href="https://telegram.me/share?text=blackarch-zsh - How I created blackarch-zsh AND How you can create your own too :) - Cloufish's Blog&url=https://cloufish.github.io/blog/posts/creating-your-own-docker-pentesting-container/" data-toggle="tooltip" data-placement="top" title="Telegram" target="_blank" rel="noopener" aria-label="Telegram"> <i class="fa-fw fab fa-telegram"></i> </a> <i class="fa-fw fas fa-link small" onclick="copyLink()" data-toggle="tooltip" data-placement="top" title="Copy link"></i> </span></div></div></div></div></div><div id="panel-wrapper" class="col-xl-3 pl-2 text-muted topbar-down"><div class="access"><div id="access-lastmod" class="post"> <span>Recent Update</span><ul class="post-content pl-0 pb-1 ml-1 mt-2"><li><a href="/blog/posts/Can-OWASP-ZAP-replace-Burp-Suite-Professional/">Can OWASP ZAP replace Burp Suite Professional?</a><li><a href="/blog/posts/OWASP-ZAP-as-a-great-fuzzing-tool/">OWASP-ZAP-Fuzzer is it a great alternative for Burp-Suite Intruder?</a><li><a href="/blog/posts/Setting-up-zap-scan-in-cicd-pipeline/">Setting up ZAP Scan in CI/CD pipeline</a><li><a href="/blog/posts/Setting-Up-Hashicorp-Vault-To-Manage-Github-Token/">Setting up Hashicorp Vault to manage our Github Token</a><li><a href="/blog/posts/Preventing-Insufficient-Logging-and-Monitoring/">Concept of Preventing Insufficient Logging & Monitoring</a></ul></div><div id="access-tags"> <span>Trending Tags</span><div class="d-flex flex-wrap mt-3 mb-1 mr-3"> <a class="post-tag" href="/blog/tags/devsecops/">devsecops</a> <a class="post-tag" href="/blog/tags/beginner/">beginner</a> <a class="post-tag" href="/blog/tags/containers/">containers</a> <a class="post-tag" href="/blog/tags/docker/">docker</a> <a class="post-tag" href="/blog/tags/blog/">blog</a> <a class="post-tag" href="/blog/tags/cms/">cms</a> <a class="post-tag" href="/blog/tags/kubernetes/">kubernetes</a> <a class="post-tag" href="/blog/tags/owasp/">owasp</a> <a class="post-tag" href="/blog/tags/pentesting-lab/">pentesting lab</a> <a class="post-tag" href="/blog/tags/zaproxy/">zaproxy</a></div></div></div><script src="https://cdn.jsdelivr.net/gh/afeld/bootstrap-toc@1.0.1/dist/bootstrap-toc.min.js"></script><div id="toc-wrapper" class="pl-0 pr-4 mb-5"> <span class="pl-3 pt-2 mb-2">Contents</span><nav id="toc" data-toggle="toc"></nav></div></div></div><div class="row"><div class="col-12 col-lg-11 col-xl-8"><div id="post-extend-wrapper" class="pl-1 pr-1 pl-sm-2 pr-sm-2 pl-md-4 pr-md-4"><div id="related-posts" class="mt-5 mb-2 mb-sm-4"><h3 class="pt-2 mt-1 mb-4 ml-1" data-toc-skip>Further Reading</h3><div class="card-deck mb-4"><div class="card"> <a href="/blog/posts/blackarch-zsh-en/"><div class="card-body"> <span class="timeago small" > Jan 27 <i class="unloaded">2021-01-27T08:46:00+01:00</i> </span><h3 class="pt-0 mt-1 mb-3" data-toc-skip>blackarch-zsh - Ideal Docker container for hacking!</h3><div class="text-muted small"><p> blackarch-zsh blackarch-zsh is my docker container that pre-configured with shell, environment tweaks while additional tools that (I found) helpful to my daily needs are installed. It also downlo...</p></div></div></a></div><div class="card"> <a href="/blog/posts/blackarch-has-its-own-official-image.md/"><div class="card-body"> <span class="timeago small" > May 30 <i class="unloaded">2021-05-30T09:46:00+02:00</i> </span><h3 class="pt-0 mt-1 mb-3" data-toc-skip>Blackarch has it's own official docker image!</h3><div class="text-muted small"><p> You can find it HERE That’s amazing news. Having an official and stable container will make it much easier to develop other blackarch containers, and I wish there was one when I was creating my co...</p></div></div></a></div><div class="card"> <a href="/blog/posts/Security-Of-Docker-Containers/"><div class="card-body"> <span class="timeago small" > May 17 <i class="unloaded">2021-05-17T07:46:00+02:00</i> </span><h3 class="pt-0 mt-1 mb-3" data-toc-skip>Security of Docker Containers</h3><div class="text-muted small"><p> Intro The use of Docker Containers has changed completely on how we deploy our applications, many though think that all the apps running in the container are completely isolated from the host syst...</p></div></div></a></div></div></div><div class="post-navigation d-flex justify-content-between"> <a href="/blog/posts/Pickle_Rick-en/" class="btn btn-outline-primary" prompt="Older"><p>TryHackMe - Pickle Rick - WRITE-UP</p></a> <a href="/blog/posts/Year_Of_The_Rabbit/" class="btn btn-outline-primary" prompt="Newer"><p>TryHackMe - Year Of The Rabbit - WRITE-UP</p></a></div></div></div></div><footer class="d-flex w-100 justify-content-center"><div class="d-flex justify-content-between align-items-center"><div class="footer-left"><p class="mb-0"> © 2021 <a href="https://twitter.com/cloufisz">Bartholomew Mokrzycki</a>. <span data-toggle="tooltip" data-placement="top" title="Except where otherwise noted, the blog posts on this site are licensed under the Creative Commons Attribution 4.0 International (CC BY 4.0) License by the author.">Some rights reserved.</span></p></div><div class="footer-right"><p class="mb-0"> Powered by <a href="https://jekyllrb.com" target="_blank" rel="noopener">Jekyll</a> with <a href="https://github.com/cotes2020/jekyll-theme-chirpy" target="_blank" rel="noopener">Chirpy</a> theme.</p></div></div></footer></div><div id="search-result-wrapper" class="d-flex justify-content-center unloaded"><div class="col-12 col-sm-11 post-content"><div id="search-hints"><h4 class="text-muted mb-4">Trending Tags</h4><a class="post-tag" href="/blog/tags/devsecops/">devsecops</a> <a class="post-tag" href="/blog/tags/beginner/">beginner</a> <a class="post-tag" href="/blog/tags/containers/">containers</a> <a class="post-tag" href="/blog/tags/docker/">docker</a> <a class="post-tag" href="/blog/tags/blog/">blog</a> <a class="post-tag" href="/blog/tags/cms/">cms</a> <a class="post-tag" href="/blog/tags/kubernetes/">kubernetes</a> <a class="post-tag" href="/blog/tags/owasp/">owasp</a> <a class="post-tag" href="/blog/tags/pentesting-lab/">pentesting lab</a> <a class="post-tag" href="/blog/tags/zaproxy/">zaproxy</a></div><div id="search-results" class="d-flex flex-wrap justify-content-center text-muted mt-3"></div></div></div></div><div id="mask"></div><a id="back-to-top" href="#" aria-label="back-to-top" class="btn btn-lg btn-box-shadow" role="button"> <i class="fas fa-angle-up"></i> </a> <script src="https://cdn.jsdelivr.net/npm/simple-jekyll-search@1.7.3/dest/simple-jekyll-search.min.js"></script> <script> SimpleJekyllSearch({ searchInput: document.getElementById('search-input'), resultsContainer: document.getElementById('search-results'), json: '/blog/assets/js/data/search.json', searchResultTemplate: '<div class="pl-1 pr-1 pl-sm-2 pr-sm-2 pl-lg-4 pr-lg-4 pl-xl-0 pr-xl-0"> <a href="https://cloufish.github.io{url}">{title}</a><div class="post-meta d-flex flex-column flex-sm-row text-muted mt-1 mb-1"> {categories} {tags}</div><p>{snippet}</p></div>', noResultsText: '<p class="mt-5">Oops! No result founds.</p>', templateMiddleware: function(prop, value, template) { if (prop === 'categories') { if (value === '') { return `${value}`; } else { return `<div class="mr-sm-4"><i class="far fa-folder fa-fw"></i>${value}</div>`; } } if (prop === 'tags') { if (value === '') { return `${value}`; } else { return `<div><i class="fa fa-tag fa-fw"></i>${value}</div>`; } } } }); </script>
